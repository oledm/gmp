<ng-form name="vm.deviceForm" novalidate>
    <h4 checkmark>Выберите объект обследования</h4>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12"
                 ng-class="{ 'has-error': vm.deviceForm.device.$touched && vm.deviceForm.device.$invalid }"
                >
              <label class="control-label" for="device">Объект обследования</label>
              <select class="form-control" required ng-model="vm.report.device"
                  ng-options="device as device.name for device in vm.devices.all track by device.id"
                  name="device" id="device">
              </select>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.device.$error" ng-if="vm.deviceForm.device.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.serial_number.$touched && vm.deviceForm.serial_number.$invalid }">
                  <label class="control-label" for="serial_number">Заводской номер</label>
                  <input class="form-control" type="text" id="serial_number" required
                      name="serial_number" ng-maxlength="200" ng-model="vm.report.obj_data.serial_number" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.serial_number.$error" ng-if="vm.deviceForm.serial_number.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.reg_number.$touched && vm.deviceForm.reg_number.$invalid }">
                  <label class="control-label" for="reg_number">Регистрационный номер</label>
                  <input class="form-control" type="text" id="reg_number" required
                      name="reg_number" ng-maxlength="200" ng-model="vm.report.obj_data.reg_number" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.reg_number.$error" ng-if="vm.deviceForm.reg_number.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.inv_number.$touched && vm.deviceForm.inv_number.$invalid }">
                  <label class="control-label" for="inv_number">Инвентарный номер</label>
                  <input class="form-control" type="text" id="inv_number" required
                      name="inv_number" ng-maxlength="200" ng-model="vm.report.obj_data.inv_number" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.inv_number.$error" ng-if="vm.deviceForm.inv_number.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.scheme.$touched && vm.deviceForm.scheme.$invalid }">
                  <label class="control-label" for="scheme">Номер чертежа</label>
                  <input class="form-control" type="text" id="scheme" required
                      name="scheme" ng-maxlength="200" ng-model="vm.report.obj_data.scheme" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.scheme.$error" ng-if="vm.deviceForm.scheme.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6"  ng-controller="DatepickerController as dc"
                 ng-class="{ 'has-error':
                     vm.deviceForm.manufactured_year.$touched &&
                     vm.deviceForm.manufactured_year.$invalid }"
                >
                  <label class="control-label" for="manufactured_year">Год изготовления</label>
                    <p class="input-group">
                    <input type="text" watcher ng-model="vm.report.obj_data.manufactured_year" id="manufactured_year" name="manufactured_year" class="form-control" uib-datepicker-popup="yyyy" ng-model-options="{timezone: 'UTC'}" is-open="dc.popup.opened" ng-required="true" datepicker-options="dc.yearOptions" required />
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="dc.open()"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                    </p>
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.manufactured_year.$error" ng-if="vm.deviceForm.manufactured_year.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            <div class="col-sm-6"  ng-controller="DatepickerController as dc"
                 ng-class="{ 'has-error':
                     vm.deviceForm.started_year.$touched &&
                     vm.deviceForm.started_year.$invalid }"
                >
                  <label class="control-label" for="started_year">Год ввода в эксплуатацию</label>
                    <p class="input-group">
                    <input type="text" watcher ng-model="vm.report.obj_data.started_year" id="started_year" name="started_year" class="form-control" uib-datepicker-popup="yyyy" ng-model-options="{timezone: 'UTC'}" is-open="dc.popup.opened" ng-required="true" datepicker-options="dc.yearOptions" required />
                  <span class="input-group-btn">
                    <button type="button" class="btn btn-default" ng-click="dc.open()"><i class="glyphicon glyphicon-calendar"></i></button>
                  </span>
                    </p>
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.started_year.$error" ng-if="vm.deviceForm.started_year.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.location.$touched && vm.deviceForm.location.$invalid }">
                  <label class="control-label" for="location">Место установки (например, &laquo;Установка подготовки пускового, топливного и импульсного газа&raquo;)</label>
                  <input class="form-control" type="text" id="location" required
                      name="location" ng-maxlength="500" ng-model="vm.report.obj_data.location" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.location.$error" ng-if="vm.deviceForm.location.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
                <!-- 
                    {{vm.report.obj_data.plant ? ' ' + vm.report.obj_data.plant : ''}}{{vm.report.obj_data.ks ? ' ' + vm.report.obj_data.ks : ''}}{{vm.report.obj_data.lpu ? ', ' + vm.report.obj_data.lpu.name : ''}}{{vm.report.obj_data.provod ? ', ' + vm.report.obj_data.provod : ''}}
                 -->
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.org.$touched && vm.deviceForm.org.$invalid }">
                  <label class="control-label" for="org">Организация</label>
                  <select class="form-control" placeholder="Организация"
                      ng-change="vm.getLPUs(vm.report.obj_data.org)" required
                      ng-model="vm.report.obj_data.org" name="org" id="org"
                      ng-options="org as org.name for org in vm.orgs track by org.id"
                  >
                  </select>
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.org.$error" ng-if="vm.deviceForm.org.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.lpu.$touched && vm.deviceForm.lpu.$invalid }">
                  <label class="control-label" for="lpu">ЛПУ МГ</label>
                  <select class="form-control" placeholder="ЛПУ МГ" required
                      ng-model="vm.report.obj_data.lpu" name="lpu" id="lpu"
                      ng-options="lpu as lpu.name for lpu in vm.report.lpus track by lpu.id">
                  </select>
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.lpu.$error" ng-if="vm.deviceForm.lpu.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.ks.$touched && vm.deviceForm.ks.$invalid }">
                  <label class="control-label" for="ks">Наименование КС или установки</label>
                  <input class="form-control" type="text" id="ks" required
                      name="ks" ng-maxlength="200" ng-model="vm.report.obj_data.ks" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.ks.$error" ng-if="vm.deviceForm.ks.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.plant.$touched && vm.deviceForm.plant.$invalid }">
                  <label class="control-label" for="plant">Номер цеха</label>
                  <input class="form-control" type="text" id="plant" required
                      name="plant" ng-maxlength="200" ng-model="vm.report.obj_data.plant" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.plant.$error" ng-if="vm.deviceForm.plant.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.provod.$touched && vm.deviceForm.provod.$invalid }">
                  <label class="control-label" for="provod">Наименование газопровода</label>
                  <input class="form-control" type="text" id="provod" required
                      name="provod" ng-maxlength="200" ng-model="vm.report.obj_data.provod" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.provod.$error" ng-if="vm.deviceForm.provod.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            <div class="col-sm-6"
                 ng-class="{ 'has-error': vm.deviceForm.condition.$touched && vm.deviceForm.condition.$invalid }"
                >
              <label class="control-label" for="condition">Состояние объекта диагностирования</label>
              <select class="form-control" required ng-model="vm.report.device.condition"
                  ng-options="condition as condition for condition in vm.device_conditions"
                  name="condition" id="condition">
              </select>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.condition.$error" ng-if="vm.deviceForm.condition.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.info_investigation.$touched && vm.deviceForm.info_investigation.$invalid }">
              <label class="control-label" for="info_investigation">Сведения об экспертизах промышленной безопасности, осмотрах и испытаниях</label>
              <textarea class="form-control" type="text" rows="7" ng-maxlength="2000" required
                  id="info_investigation" name="info_investigation"
                  ng-model="vm.report.info.info_investigation"></textarea>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.info_investigation.$error" ng-if="vm.deviceForm.info_investigation.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.info_repair.$touched && vm.deviceForm.info_repair.$invalid }">
              <label class="control-label" for="info_repair">Сведения о замене или ремонте элементов сосуда</label>
              <textarea class="form-control" type="text" rows="2" ng-maxlength="2000" required
                  id="info_repair" name="info_repair"
                  ng-model="vm.report.info.info_repair"></textarea>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.info_repair.$error" ng-if="vm.deviceForm.info_repair.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.danger_places.$touched && vm.deviceForm.danger_places.$invalid }">
              <label class="control-label" for="danger_places">Сведения о замене или ремонте элементов сосуда</label>
              <textarea class="form-control" type="text" rows="3" ng-maxlength="2000" required
                  id="danger_places" name="danger_places"
                  ng-model="vm.report.info.danger_places"></textarea>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.danger_places.$error" ng-if="vm.deviceForm.danger_places.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>
</ng-form>
