<ng-form name="vm.deviceForm" novalidate>
    <h4 checkmark>Выберите объект обследования</h4>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12"
                 ng-class="{ 'has-error': vm.deviceForm.device.$touched && vm.deviceForm.device.$invalid }"
                >
              <label class="control-label" for="device">Объект обследования</label>
              <select class="form-control" required ng-model="vm.report.device"
                  ng-options="device as device.full_desc_capital for device in vm.devices.all track by device.id"
                  name="device" id="device">
              </select>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.device.$error" ng-if="vm.deviceForm.device.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div ng-if="vm.report.device.full_desc" class="well">
        <p>Заводской номер:&nbsp;{{vm.report.device.serial_number}}</p>
        <p>Регистрационный номер:&nbsp;{{vm.report.device.reg_number}}</p>
        <p>Инвентарный номер:&nbsp;{{vm.report.device.inv_number}}</p>
        <p>Завод-изготовитель:&nbsp;{{vm.report.device.factory}}</p>
        <p>Номер чертежа:&nbsp;{{vm.report.device.scheme}}</p>
        <p>Год изготовления:&nbsp;{{vm.report.device.manufactured_year}}</p>
        <p>Год ввода в эксплуатацию:&nbsp;{{vm.report.device.started_year}}</p>
        <p>Место установки:&nbsp;{{vm.report.device.location}}{{vm.report.obj_data.plant ? ' ' + vm.report.obj_data.plant : ''}}{{vm.report.obj_data.ks ? ' ' + vm.report.obj_data.ks : ''}}{{vm.report.obj_data.lpu ? ', ' + vm.report.obj_data.lpu.name : ''}}</p>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.org.$touched && vm.deviceForm.org.$invalid }">
                  <label class="control-label" for="org">Организация</label>
                  <select class="form-control" placeholder="Организация"
                      ng-change="vm.getLPUs(vm.report.obj_data.org)" required
                      ng-model="vm.report.obj_data.org" name="org" id="org"
                      ng-options="org as org.name for org in vm.orgs track by org.id"
                  >
                      <!-- 
                          <option ng-repeat="org in vm.orgs">{{org.name}}</option>
                       -->
                  </select>
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.org.$error" ng-if="vm.deviceForm.org.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.lpu.$touched && vm.deviceForm.lpu.$invalid }">
                  <label class="control-label" for="lpu">ЛПУ МГ</label>
                  <select class="form-control" placeholder="ЛПУ МГ" required
                      ng-model="vm.report.obj_data.lpu" name="lpu" id="lpu"
                      ng-options="lpu as lpu.name for lpu in vm.report.lpus track by lpu.id">
                  </select>
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.lpu.$error" ng-if="vm.deviceForm.lpu.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.ks.$touched && vm.deviceForm.ks.$invalid }">
                  <label class="control-label" for="ks">Наименование КС или установки</label>
                  <input class="form-control" type="text" id="ks" required
                      name="ks" ng-maxlength="50" ng-model="vm.report.obj_data.ks" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.ks.$error" ng-if="vm.deviceForm.ks.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
            
            <div class="col-sm-6" ng-class="{ 'has-error': vm.deviceForm.plant.$touched && vm.deviceForm.plant.$invalid }">
                  <label class="control-label" for="plant">Название цеха</label>
                  <input class="form-control" type="text" id="plant" required
                      name="plant" ng-maxlength="50" ng-model="vm.report.obj_data.plant" />
                  <div class="help-block" role="alert" ng-messages="vm.deviceForm.plant.$error" ng-if="vm.deviceForm.plant.$touched">
                      <div ng-messages-include="/static/src/assets/messages.html"></div>
                  </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12"
                 ng-class="{ 'has-error': vm.deviceForm.condition.$touched && vm.deviceForm.condition.$invalid }"
                >
              <label class="control-label" for="condition">Состояние объекта диагностирования</label>
              <select class="form-control" required ng-model="vm.report.device.condition"
                  ng-options="condition as condition for condition in vm.device_conditions"
                  device as device.full_desc_capital for device in vm.devices.all track by device.id
                  name="condition" id="condition">
              </select>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.condition.$error" ng-if="vm.deviceForm.condition.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.info_investigation.$touched && vm.deviceForm.info_investigation.$invalid }">
              <label class="control-label" for="info_investigation">Сведения об экспертизах промышленной безопасности, осмотрах и испытаниях</label>
              <textarea class="form-control" type="text" rows="7" ng-maxlength="2000" required
                  id="info_investigation" name="info_investigation"
                  ng-model="vm.report.info.info_investigation"></textarea>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.info_investigation.$error" ng-if="vm.deviceForm.info_investigation.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.info_repair.$touched && vm.deviceForm.info_repair.$invalid }">
              <label class="control-label" for="info_repair">Сведения о замене или ремонте элементов сосуда</label>
              <textarea class="form-control" type="text" rows="2" ng-maxlength="2000" required
                  id="info_repair" name="info_repair"
                  ng-model="vm.report.info.info_repair"></textarea>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.info_repair.$error" ng-if="vm.deviceForm.info_repair.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="row">
            <div class="col-sm-12" ng-class="{ 'has-error': vm.deviceForm.danger_places.$touched && vm.deviceForm.danger_places.$invalid }">
              <label class="control-label" for="danger_places">Сведения о замене или ремонте элементов сосуда</label>
              <textarea class="form-control" type="text" rows="3" ng-maxlength="2000" required
                  id="danger_places" name="danger_places"
                  ng-model="vm.report.info.danger_places"></textarea>
              <div class="help-block" role="alert" ng-messages="vm.deviceForm.danger_places.$error" ng-if="vm.deviceForm.danger_places.$touched">
                  <div ng-messages-include="/static/src/assets/messages.html"></div>
              </div>
            </div>
        </div>
    </div>

</ng-form>
